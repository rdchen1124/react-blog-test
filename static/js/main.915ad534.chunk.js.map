{"version":3,"sources":["contexts.js","utils.js","components/Header/Header.js","WebAPI.js","pages/Home/Home.js","pages/Login/Login.js","pages/Post/Post.js","components/App/App.js","index.js"],"names":["AuthContext","createContext","TOKEN_NAME","setAuthToken","token","window","localStorage","setItem","getAuthToken","getItem","HeaderContainer","styled","div","NavList","Nav","Link","props","$active","PrimaryContainer","SecondaryContainer","TitleContainer","Header","location","useLocation","useContext","user","setUser","history","useHistory","to","pathname","onClick","push","BASE_URL","getMe","fetch","headers","then","res","json","Root","PostContainer","PostTitle","PostDate","Post","post","id","title","Date","createdAt","toLocaleString","Home","useState","posts","setPosts","useEffect","data","map","prototype","PropTypes","object","ErrorMessage","Login","username","setUsername","password","setPassword","errMesg","setErrMesg","onSubmit","e","preventDefault","method","body","JSON","stringify","login","ok","message","type","value","onChange","target","toString","SinglePostContainer","SinglePostTitle","SinglePostContent","SinglePost","article","Article","postId","useParams","setArticle","Number","App","useLayoutEffect","Provider","exact","path","ReactDOM","render","document","getElementById"],"mappings":"4LAEaA,EAAcC,wBAAc,MCFnCC,EAAa,QACNC,EAAe,SAACC,GAC3BC,OAAOC,aAAaC,QAAQL,EAAYE,IAE7BI,EAAe,WAC1B,OAAOH,OAAOC,aAAaG,QAAQP,I,OCA/BQ,EAAkBC,IAAOC,IAAV,oRAafC,EAAUF,IAAOC,IAAV,uFAKPE,EAAMH,YAAOI,IAAPJ,CAAH,oOAUL,SAAAK,GAAK,OAAEA,EAAMC,SAAN,+CAILC,EAAmBP,IAAOC,IAAV,2GAGlBC,GAIEM,EAAqBR,IAAOC,IAAV,8CAGlBQ,EAAiBT,IAAOC,IAAV,qEA2CLS,I,UAAAA,EAvCf,WACE,IAAMC,EAAWC,cADD,EAEUC,qBAAWxB,GAA7ByB,EAFQ,EAERA,KAAMC,EAFE,EAEFA,QACRC,EAAUC,cAQhB,OACE,eAAClB,EAAD,WACE,eAACQ,EAAD,WACE,cAACE,EAAD,qBAGA,eAACP,EAAD,WACE,cAACC,EAAD,CAAKe,GAAG,IAAIZ,QAA6B,MAApBK,EAASQ,SAA9B,0BAGCL,GAAQ,cAACX,EAAD,CAAKe,GAAG,QAAQZ,QAA6B,UAApBK,EAASQ,SAAlC,4CAKb,cAACX,EAAD,UACE,eAACN,EAAD,YACIY,GAAQ,cAACX,EAAD,CAAKe,GAAG,SAASZ,QAA6B,WAApBK,EAASQ,SAAnC,0BAGTL,GAAQ,cAACX,EAAD,CAAKiB,QA3BD,WACnB5B,EAAa,IACbuB,EAAQ,MACiB,MAAtBJ,EAASQ,UACVH,EAAQK,KAAK,MAuBA,mC,iBCjFbC,EAAW,qCAsBJC,EAAQ,WACnB,IAAM9B,EAAQI,IACd,OAAO2B,MAAM,GAAD,OAAIF,EAAJ,OAAmB,CAC7BG,QAAS,CACP,cAAgB,UAAhB,OAA2BhC,MAE5BiC,MAAK,SAAAC,GAAG,OAAEA,EAAIC,WCvBbC,EAAO7B,IAAOC,IAAV,8DAIJ6B,EAAgB9B,IAAOC,IAAV,8KAOb8B,EAAY/B,YAAOI,IAAPJ,CAAH,8FAKTgC,EAAWhC,IAAOC,IAAV,4CAGd,SAASgC,EAAT,GAAwB,IAARC,EAAO,EAAPA,KACd,OACE,eAACJ,EAAD,WACE,cAACC,EAAD,CAAWb,GAAE,iBAAYgB,EAAKC,IAA9B,SAAqCD,EAAKE,QAC1C,cAACJ,EAAD,UAAW,IAAIK,KAAKH,EAAKI,WAAWC,sBAQ3B,SAASC,IAAQ,IAAD,EACHC,mBAAS,IADN,mBACtBC,EADsB,KACfC,EADe,KAK7B,OAHAC,qBAAU,WDnCHpB,MAAM,GAAD,OAAIF,EAAJ,gDACXI,MAAK,SAAAC,GAAG,OAAEA,EAAIC,UCmCFF,MAAK,SAAAmB,GAAI,OAAEF,EAASE,QAC/B,IAEA,cAAChB,EAAD,UAEIa,GAASA,EAAMI,KAAI,SAAAZ,GAAI,OACvB,cAACD,EAAD,CAAoBC,KAAMA,GAAfA,EAAKC,SAZxBF,EAAKc,UAAY,CACfb,KAAMc,IAAUC,QC5BlB,I,QAAMC,EAAelD,IAAOC,IAAV,uGAMH,SAASkD,IAAS,IACvBpC,EAAYF,qBAAWxB,GAAvB0B,QADsB,EAEE0B,mBAAS,IAFX,mBAEvBW,EAFuB,KAEbC,EAFa,OAGEZ,mBAAS,IAHX,mBAGvBa,EAHuB,KAGbC,EAHa,OAIAd,mBAAS,IAJT,mBAIvBe,EAJuB,KAIdC,EAJc,KAKxBzC,EAAUC,cAoBhB,OACE,uBAAMyC,SApBa,SAACC,GACpBA,EAAEC,iBACFH,EAAW,IFVM,SAACL,EAAUE,GAC9B,OAAO9B,MAAM,GAAD,OAAIF,EAAJ,UAAsB,CAChCuC,OAAQ,OACRpC,QAAS,CACP,eAAgB,oBAElBqC,KAAMC,KAAKC,UAAU,CACnBZ,WACAE,eAED5B,MAAK,SAAAC,GAAG,OAAEA,EAAIC,UECfqC,CAAMb,EAAUE,GAAU5B,MAAK,SAAAmB,GAC7B,GAAe,IAAZA,EAAKqB,GACN,OAAOT,EAAWZ,EAAKsB,SAEzB3E,EAAaqD,EAAKpD,OAClB8B,IAAQG,MAAK,SAAAC,GACX,GAAc,IAAXA,EAAIuC,GAEL,OADA1E,EAAa,MACNiE,EAAW9B,EAAIwC,SAExBpD,EAAQY,EAAIkB,MACZ7B,EAAQK,KAAK,YAMjB,UACE,6CAAgB,IACd,uBACE+C,KAAK,OACLC,MAAOjB,EACPkB,SAAU,SAACX,GAAD,OAAKN,EAAYM,EAAEY,OAAOF,aAGxC,6CAAgB,IACd,uBACED,KAAK,WACLC,MAAOf,EACPgB,SAAU,SAAAX,GAAC,OAAEJ,EAAYI,EAAEY,OAAOF,aAEtC,0CAEEb,GAAW,cAACN,EAAD,UAAeM,EAAQgB,gBC/C3B,SAASvC,IACtB,OACE,+CAGJ,I,EAAMJ,EAAO7B,IAAOC,IAAV,8DAIJwE,EAAsBzE,IAAOC,IAAV,kDAGnByE,GAAkB1E,IAAOC,IAAV,yFAKf0E,GAAoB3E,IAAOC,IAAV,8IAMvB,SAAS2E,GAAT,GAAiC,IAAXC,EAAU,EAAVA,QACpB,OACE,eAACJ,EAAD,WACE,cAACC,GAAD,UAAkBG,EAAQzC,QAC1B,cAACuC,GAAD,UAAoBE,EAAQf,UAI3B,SAASgB,KAAW,IACnBC,EAAWC,cAAXD,OADkB,EAEMtC,mBAAS,IAFf,mBAEjBoC,EAFiB,KAERI,EAFQ,KAMxB,OAHArC,qBAAU,WHnCW,IAACT,KGoCZ+C,OAAOH,GHnCVvD,MAAM,GAAD,OAAIF,EAAJ,qBAAyBa,IACpCT,MAAK,SAAAC,GAAG,OAAEA,EAAIC,WGkCWF,MAAK,SAAAmB,GAAI,OAAEoC,EAAWpC,EAAK,SACnD,CAACkC,IAED,cAAC,EAAD,UACE,cAACH,GAAD,CAAYC,QAASA,MChC3B,IAAMhD,GAAO7B,IAAOC,IAAV,kDAuCKkF,OApCf,WAAgB,IAAD,EACW1C,mBAAS,MADpB,mBACN3B,EADM,KACAC,EADA,KAYb,OAVAqE,2BAAgB,WAEXvF,KACD0B,IAAQG,MAAK,SAAAC,GACRA,EAAIuC,IACLnD,EAAQY,EAAIkB,WAIjB,IAED,cAACxD,EAAYgG,SAAb,CAAsBhB,MAAO,CAACvD,OAAMC,WAApC,SACE,cAAC,GAAD,UACE,eAAC,IAAD,WACE,cAAC,EAAD,IACA,eAAC,IAAD,WACE,cAAC,IAAD,CAAOuE,OAAK,EAACC,KAAK,IAAlB,SACE,cAAC/C,EAAD,MAEF,cAAC,IAAD,CAAO+C,KAAK,QAAZ,SACE,cAAC,EAAD,MAEF,cAAC,IAAD,CAAOA,KAAK,iBAAZ,SACE,cAACT,GAAD,MAEF,cAAC,IAAD,CAAOS,KAAK,SAAZ,SACE,cAACpC,EAAD,iBC1CdqC,IAASC,OACP,cAAC,GAAD,IACAC,SAASC,eAAe,W","file":"static/js/main.915ad534.chunk.js","sourcesContent":["import { createContext } from \"react\";\r\n\r\nexport const AuthContext = createContext(null);","const TOKEN_NAME = 'token';\r\nexport const setAuthToken = (token) => {\r\n  window.localStorage.setItem(TOKEN_NAME, token);\r\n}\r\nexport const getAuthToken = () => {\r\n  return window.localStorage.getItem(TOKEN_NAME);\r\n}","import React, { useContext } from 'react';\nimport styled from 'styled-components';\nimport { Link, useLocation, useHistory } from \"react-router-dom\";\nimport { AuthContext } from '../../contexts';\nimport { setAuthToken } from '../../utils';\nconst HeaderContainer = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 60px;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.3);\n  box-sizing: border-box;\n  padding: 0px 32px; \n`\nconst NavList = styled.div`\n  display: flex;\n  align-items: center;\n  height: 60px;\n`\nconst Nav = styled(Link)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  box-sizing: border-box;\n  height: 100%;\n  width: 100px;\n  cursor: pointer;\n  color: blue;\n  text-decoration: none;\n  ${props=>props.$active && `\n    background: rgba(0, 0, 0, 0.2);\n  `}\n`\nconst PrimaryContainer = styled.div`\n  display: flex;\n  align-items: center;\n  ${NavList} {\n    margin-left: 10px;\n  }\n`\nconst SecondaryContainer = styled.div`\n  display: flex;\n`\nconst TitleContainer = styled.div`\n  font-size: 32px;\n  font-weight:bold;\n`\nfunction Header() {\n  const location = useLocation();\n  const { user, setUser } = useContext(AuthContext);\n  const history = useHistory();\n  const handleLogout = () => {\n    setAuthToken('');\n    setUser(null);\n    if(location.pathname !== '/'){\n      history.push('/');\n    }\n  }\n  return (\n    <HeaderContainer>\n      <PrimaryContainer>\n        <TitleContainer>\n          Medium\n        </TitleContainer>\n        <NavList>\n          <Nav to='/' $active={location.pathname==='/'}>\n            首頁\n          </Nav>\n          {user && <Nav to='/post' $active={location.pathname==='/post'}>\n            發表文章\n          </Nav>}\n        </NavList>\n      </PrimaryContainer>\n      <SecondaryContainer>\n        <NavList>\n          {!user && <Nav to='/login' $active={location.pathname==='/login'}>\n            登入\n          </Nav>}\n          {user && <Nav onClick={handleLogout}>\n            登出\n          </Nav>}\n        </NavList>\n      </SecondaryContainer>\n    </HeaderContainer>\n  )\n}\nexport default Header;","import { getAuthToken } from \"./utils\";\r\nconst BASE_URL = 'https://student-json-api.lidemy.me';\r\n\r\nexport const getPosts = () => {\r\n  return fetch(`${BASE_URL}/posts?_sort=createdAt&_order=desc&_limit=5`)\r\n  .then(res=>res.json())\r\n}\r\nexport const getPost = (id) => {\r\n  return fetch(`${BASE_URL}/posts?id=${id}`)\r\n  .then(res=>res.json())\r\n}\r\nexport const login = (username, password) => {\r\n  return fetch(`${BASE_URL}/login`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'content-type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      username,\r\n      password\r\n    })\r\n  }).then(res=>res.json())\r\n}\r\nexport const getMe = () => {\r\n  const token = getAuthToken();\r\n  return fetch(`${BASE_URL}/me`, {\r\n    headers: {\r\n      'authorization': `Bearer ${token}`\r\n    }\r\n  }).then(res=>res.json())\r\n}","import React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport PropTypes from 'prop-types';\nimport { Link } from \"react-router-dom\";\nimport {getPosts} from '../../WebAPI';\n\nconst Root = styled.div`\n  width: 90%;\n  margin: 0 auto;\n`;\nconst PostContainer = styled.div`\n  display: flex;\n  justify-content: space-between;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.2); \n  padding: 16px;\n  align-items: flex-end;\n`;\nconst PostTitle = styled(Link)`\n  font-size: 20px;\n  color: seagreen;\n  text-decoration: none;\n`\nconst PostDate = styled.div`\n  color: grey;\n`\nfunction Post({ post }){\n  return (\n    <PostContainer>\n      <PostTitle to={`/posts/${post.id}`}>{post.title}</PostTitle>\n      <PostDate>{new Date(post.createdAt).toLocaleString()}</PostDate>\n    </PostContainer>\n    \n  )\n}\nPost.prototype = {\n  post: PropTypes.object\n}\nexport default function Home() {\n  const [posts, setPosts] = useState([]);\n  useEffect(()=>{\n    getPosts().then(data=>setPosts(data))\n  },[]);\n  return (\n    <Root>\n      {\n        posts && posts.map(post=>(\n        <Post key={post.id} post={post} />\n        ))\n      }\n    </Root>\n  )\n}","import React, { useCallback, useContext, useState } from 'react';\nimport styled from 'styled-components';\n// import PropTypes from 'prop-types';\nimport { login, getMe } from '../../WebAPI';\nimport { setAuthToken } from '../../utils';\nimport { useHistory } from \"react-router-dom\";\nimport { AuthContext } from '../../contexts';\nconst ErrorMessage = styled.div`\n  background: red;\n  color: white;\n  padding: 2px 5px;\n  width: 300px;\n`\nexport default function Login() {\n  const { setUser } = useContext(AuthContext);\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [errMesg, setErrMesg] = useState('');\n  const history = useHistory();\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    setErrMesg('');\n    login(username, password).then(data=>{\n      if(data.ok === 0){\n        return setErrMesg(data.message);\n      }\n      setAuthToken(data.token);\n      getMe().then(res => {\n        if(res.ok !== 1){\n          setAuthToken(null);\n          return setErrMesg(res.message);\n        }\n        setUser(res.data)\n        history.push('/');\n      })\n      \n    });\n  }\n  return (\n    <form onSubmit={handleSubmit}>\n      <div>username: {\" \"}\n        <input \n          type='text'\n          value={username}\n          onChange={(e)=>setUsername(e.target.value)}\n        />\n      </div>\n      <div>password: {\" \"}\n        <input\n          type='password'\n          value={password}\n          onChange={e=>setPassword(e.target.value)}\n        /></div>\n      <button>send</button>\n      {\n        errMesg && <ErrorMessage>{errMesg.toString()}</ErrorMessage>\n      }\n    </form>\n  )\n}","import React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { getPost } from '../../WebAPI';\n// import PropTypes from 'prop-types';\nimport {\n  useParams\n} from \"react-router-dom\";\n\nexport default function Post() {\n  return (\n    <div>Post article</div>\n  )\n}\nconst Root = styled.div`\n  width: 90%;\n  margin: 0 auto;\n`;\nconst SinglePostContainer = styled.div`\n  padding: 5px 10px;\n`\nconst SinglePostTitle = styled.div`\n  font-size: 28px;\n  font-weight: bold;\n  color: skyblue;\n`\nconst SinglePostContent = styled.div`\n  margin-top: 10px;\n  white-space: pre-line;\n  padding: 10px 0px;\n  border-top: 1px solid rgba(0, 0, 0, 0.2);\n`\nfunction SinglePost({ article }){\n  return (\n    <SinglePostContainer>\n      <SinglePostTitle>{article.title}</SinglePostTitle>\n      <SinglePostContent>{article.body}</SinglePostContent>\n    </SinglePostContainer>\n  )\n}\nexport function Article() {\n  let { postId } = useParams();\n  const [article, setArticle] = useState({});\n  useEffect(()=>{\n    getPost(Number(postId)).then(data=>setArticle(data[0]))\n  },[postId])\n  return (\n    <Root>\n      <SinglePost article={article} />\n    </Root>\n  )\n}","import React, { useState, useLayoutEffect } from 'react';\nimport styled from 'styled-components';\n// import PropTypes from 'prop-types';\nimport {\n  HashRouter as Router,\n  Switch,\n  Route\n} from \"react-router-dom\";\nimport Header from '../Header' \nimport Home from '../../pages/Home';\nimport Login from '../../pages/Login';\nimport Post, { Article } from '../../pages/Post';\nimport { AuthContext } from '../../contexts';\nimport { getMe } from '../../WebAPI';\nimport { getAuthToken } from '../../utils';\nconst Root = styled.div`\n  padding-top: 60px;\n`;\nfunction App() {\n  const [user, setUser] = useState(null);\n  useLayoutEffect(()=>{\n    //(TODO) 有 token 才會 call getMe() 檢查 token，若檢查完成才算登入\n    if(getAuthToken()){\n      getMe().then(res=>{\n        if(res.ok){\n          setUser(res.data);\n        }\n      })\n    }\n  }, [])\n  return (\n    <AuthContext.Provider value={{user, setUser}}>\n      <Root>\n        <Router>\n          <Header />\n          <Switch>\n            <Route exact path='/'>\n              <Home />\n            </Route>\n            <Route path='/post'>\n              <Post />\n            </Route>\n            <Route path='/posts/:postId'>\n              <Article />\n            </Route>\n            <Route path='/login'>\n              <Login />\n            </Route>\n          </Switch>\n        </Router>\n      </Root>\n    </AuthContext.Provider>\n  )\n}\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);"],"sourceRoot":""}